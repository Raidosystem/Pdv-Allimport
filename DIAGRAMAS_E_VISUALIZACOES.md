# ğŸ¨ DIAGRAMAS DE FLUXO E VISUALIZAÃ‡Ã•ES

## 1. ESTRUTURA GERAL DO SISTEMA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PDV ALLIMPORT - ARQUITETURA                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          USUÃRIO
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚   Login   â”‚    â”‚   Signup  â”‚
              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AuthContext    â”‚
                    â”‚  (Supabase)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚Dashboardâ”‚   â”‚Permissions â”‚ â”‚Subscr     â”‚
         â”‚(Menu)   â”‚   â”‚(RLS)       â”‚ â”‚(Active?)  â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
    â”‚         â”‚      â”‚       â”‚      â”‚     â”‚      â”‚     â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â” â”Œâ”€â–¼â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â” â”Œâ”´â”€â”€â”â”Œâ”€â”´â”€â”€â”â”Œâ”€â”€â”´â”€â”â”Œâ”€â”´â”€â”€â”
â”‚Vendasâ”‚ â”‚Caixa â”‚ â”‚ OS â”‚ â”‚RelatÃ³riosâ”‚Produtosâ”‚Adminâ”‚Configâ”‚
â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”€â”€â”˜ â””â”¬â”€â”€â”˜â””â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”˜â””â”€â”¬â”€â”€â”˜
    â”‚        â”‚      â”‚      â”‚      â”‚     â”‚      â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚     â”‚
             â”‚                          â”‚      â”‚     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚     â”‚
    â”‚   SERVIÃ‡OS & HOOKS          â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
    â”‚                             â”‚     â”‚      â”‚
    â”‚  - caixaService             â”‚     â”‚      â”‚
    â”‚  - salesService             â”‚     â”‚      â”‚
    â”‚  - realReportsService       â”‚     â”‚      â”‚
    â”‚  - useCaixa()               â”‚     â”‚      â”‚
    â”‚  - usePermissions()         â”‚     â”‚      â”‚
    â”‚  - useModulosHabilitados()  â”‚     â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
             â”‚                          â”‚      â”‚
             â–¼                          â–¼      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         SUPABASE (PostgreSQL)               â”‚
    â”‚                                             â”‚
    â”‚  Tables:                                    â”‚
    â”‚  â”œâ”€ auth.users                              â”‚
    â”‚  â”œâ”€ empresas (modulos_habilitados)          â”‚
    â”‚  â”œâ”€ caixa (status, valor_inicial)           â”‚
    â”‚  â”œâ”€ vendas (user_id, caixa_id)              â”‚
    â”‚  â”œâ”€ vendas_itens (produto_id, quantidade)   â”‚
    â”‚  â”œâ”€ movimentacoes_caixa (entrada/saida)     â”‚
    â”‚  â”œâ”€ produtos (nome, preco, estoque)         â”‚
    â”‚  â”œâ”€ clientes (nome, cpf_cnpj)               â”‚
    â”‚  â”œâ”€ funcionarios (nome, funcao_id)          â”‚
    â”‚  â”œâ”€ funcoes (permissoes)                    â”‚
    â”‚  â””â”€ user_approvals (admin roles)            â”‚
    â”‚                                             â”‚
    â”‚  RLS: Todos os dados protegidos por user_id â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUXO COMPLETO: ABERTURA DE CAIXA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DASHBOARD (/dashboard)              â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [Vendas] [Clientes] [Produtos] [Caixa] ...    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                              â”‚
â”‚              Clique no menu "Caixa"                   â”‚
â”‚                       â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    CAIXA PAGE (/caixa)            â”‚
        â”‚                                   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ Status Caixa: Nenhum aberto  â”‚ â”‚
        â”‚  â”‚                              â”‚ â”‚
        â”‚  â”‚  [Abrir Caixa]  [HistÃ³rico]  â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                   â”‚
        â”‚          Clique em                â”‚
        â”‚       [Abrir Caixa]               â”‚
        â”‚                                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MODAL: ABRIR CAIXA                â”‚
    â”‚                                     â”‚
    â”‚  Valor Inicial: [____________]      â”‚
    â”‚  ObservaÃ§Ãµes:   [____________]      â”‚
    â”‚                                     â”‚
    â”‚      [Cancelar] [Abrir Caixa]       â”‚
    â”‚                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼ (onClick Abrir)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useCaixa().abrirCaixa()     â”‚
        â”‚                             â”‚
        â”‚ 1. Valida dados             â”‚
        â”‚ 2. Chama caixaService       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ caixaService.abrirCaixa()   â”‚
        â”‚                             â”‚
        â”‚ 1. Verifica autenticaÃ§Ã£o    â”‚
        â”‚ 2. Busca caixa aberto hoje  â”‚
        â”‚    (se existe, retorna ele) â”‚
        â”‚ 3. SenÃ£o, cria novo         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ INSERT INTO caixa                   â”‚
        â”‚   user_id = auth.uid()              â”‚
        â”‚   valor_inicial = 100.00            â”‚
        â”‚   status = 'aberto'                 â”‚
        â”‚   data_abertura = NOW()             â”‚
        â”‚   criado_em = NOW()                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼ (Sucesso)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Recarrega caixa             â”‚
        â”‚ (buscarCaixaAtual)          â”‚
        â”‚                             â”‚
        â”‚ SELECT * FROM caixa         â”‚
        â”‚ WHERE usuario_id = ?        â”‚
        â”‚ AND status = 'aberto'       â”‚
        â”‚                             â”‚
        â”‚ + Busca movimentaÃ§Ãµes       â”‚
        â”‚ + Calcula resumo            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Toast:                      â”‚
        â”‚ "Caixa aberto com sucesso!" â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    CAIXA PAGE ATUALIZADO             â”‚
    â”‚                                      â”‚
    â”‚  Status: âœ… CAIXA ABERTO             â”‚
    â”‚                                      â”‚
    â”‚  Valor Inicial:      R$ 100,00       â”‚
    â”‚  Total Entradas:     R$ 0,00         â”‚
    â”‚  Total Saidas:       R$ 0,00         â”‚
    â”‚  Saldo Atual:        R$ 100,00       â”‚
    â”‚                                      â”‚
    â”‚  [Adicionar MovimentaÃ§Ã£o]            â”‚
    â”‚  [Fechar Caixa]                      â”‚
    â”‚  [Ver HistÃ³rico]                     â”‚
    â”‚                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FLUXO: VENDA â†’ CAIXA AUTOMÃTICO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SALES PAGE (/vendas)           â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Verificar Caixa Aberto          â”‚   â”‚
â”‚  â”‚ âŒ Se fechado â†’ "Abra um caixa"  â”‚   â”‚
â”‚  â”‚ âœ… Se aberto â†’ Continuar        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ProductSearch                   â”‚   â”‚
â”‚  â”‚ [Buscar produto...]             â”‚   â”‚
â”‚  â”‚ â””â”€ Busca por cÃ³digo ou nome     â”‚   â”‚
â”‚  â”‚    + Exibe estoque disponÃ­vel   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“ (Clica no produto)  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Carrinho                        â”‚   â”‚
â”‚  â”‚ - Produto A x 2 = R$ 50,00      â”‚   â”‚
â”‚  â”‚ - Produto B x 1 = R$ 30,00      â”‚   â”‚
â”‚  â”‚ - Produto C x 3 = R$ 90,00      â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚ Subtotal:      R$ 170,00        â”‚   â”‚
â”‚  â”‚ Desconto:      R$ 10,00 (-6%)   â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚ Total:         R$ 160,00        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ClienteSelector (Opcional)      â”‚   â”‚
â”‚  â”‚ [Buscar cliente...]             â”‚   â”‚
â”‚  â”‚ - Se selecionado, vincula venda â”‚   â”‚
â”‚  â”‚ - Se nÃ£o, venda "avulsa"        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PagamentoForm                   â”‚   â”‚
â”‚  â”‚ Forma de Pagamento:             â”‚   â”‚
â”‚  â”‚ [PIX] [CartÃ£o CrÃ©dito]          â”‚   â”‚
â”‚  â”‚ [CartÃ£o DÃ©bito] [Dinheiro]      â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚ Valor recebido: [160.00]        â”‚   â”‚
â”‚  â”‚ Troco: R$ 0,00                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â†“                     â”‚
â”‚         [Completar Venda]              â”‚
â”‚                   â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ salesService.create()     â”‚
        â”‚                           â”‚
        â”‚ Valida dados:             â”‚
        â”‚ âœ… Caixa aberto?          â”‚
        â”‚ âœ… Assinatura ativa?      â”‚
        â”‚ âœ… Estoque OK?            â”‚
        â”‚ âœ… Total > 0?             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ TRANSAÃ‡ÃƒO SUPABASE       â”‚
        â”‚                          â”‚
        â”‚ 1. INSERT INTO vendas    â”‚
        â”‚    - user_id             â”‚
        â”‚    - caixa_id            â”‚
        â”‚    - cliente_id          â”‚
        â”‚    - total_amount        â”‚
        â”‚    - desconto_amount     â”‚
        â”‚    - payment_method      â”‚
        â”‚                          â”‚
        â”‚ 2. INSERT vendas_itens   â”‚
        â”‚    - venda_id            â”‚
        â”‚    - produto_id          â”‚
        â”‚    - quantidade          â”‚
        â”‚    - unit_price          â”‚
        â”‚    (mÃºltiplas linhas)    â”‚
        â”‚                          â”‚
        â”‚ 3. UPDATE produtos       â”‚
        â”‚    (reduz estoque)       â”‚
        â”‚                          â”‚
        â”‚ 4. INSERT movimento      â”‚
        â”‚    movimentacoes_caixa   â”‚
        â”‚    - caixa_id            â”‚
        â”‚    - tipo: 'entrada'     â”‚
        â”‚    - valor: 160.00       â”‚
        â”‚    - descricao: "Venda"  â”‚
        â”‚                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Dispara evento:           â”‚
        â”‚ 'saleCompleted'           â”‚
        â”‚                           â”‚
        â”‚ window.dispatchEvent(     â”‚
        â”‚  new Event('saleCompleted')â”‚
        â”‚ )                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚               â”‚
    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚useCaixaâ”‚   â”‚PrintReceiptâ”‚   â”‚UpdateCartâ”‚
â”‚Listenerâ”‚   â”‚ (se ativo) â”‚   â”‚(limpar)  â”‚
â”‚        â”‚   â”‚            â”‚   â”‚          â”‚
â”‚carrega â”‚   â”‚ Gera       â”‚   â”‚ Reseta   â”‚
â”‚Caixa   â”‚   â”‚ cupom      â”‚   â”‚ estado   â”‚
â”‚        â”‚   â”‚            â”‚   â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚ Imprime    â”‚   â”‚ Limpa    â”‚
     â”‚       â”‚ automatico â”‚   â”‚ carrinho â”‚
     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Caixa Recarregado Automaticamenteâ”‚
â”‚                                  â”‚
â”‚ Saldo Anterior:   R$ 100,00      â”‚
â”‚ + Venda:          R$ 160,00      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ Saldo Atual:      R$ 260,00 âœ…   â”‚
â”‚                                  â”‚
â”‚ Total MovimentaÃ§Ãµes: +1          â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toast: "Venda registrada!"       â”‚
â”‚                                  â”‚
â”‚ OpÃ§Ãµes:                          â”‚
â”‚ [Imprimir Cupom] [Nova Venda]    â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. FLUXO: RELATÃ“RIOS COM GRÃFICOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DASHBOARD (/dashboard)                 â”‚
â”‚                                            â”‚
â”‚  Menu "RelatÃ³rios"                         â”‚
â”‚  â”œâ”€ Vendas do Dia â†’ /relatorios/resumo    â”‚
â”‚  â”œâ”€ PerÃ­odo â†’ /relatorios/periodo         â”‚
â”‚  â”œâ”€ Ranking â†’ /relatorios/ranking         â”‚
â”‚  â””â”€ Analytics Moderno â†’ /relatorios/      â”‚
â”‚                                            â”‚
â”‚    [Clica em "Analytics Moderno"]          â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ RelatoriosPageAdvanced.tsx        â”‚
    â”‚ (/relatorios)                    â”‚
    â”‚                                  â”‚
    â”‚ 1. Componente monta              â”‚
    â”‚ 2. useEffect dispara             â”‚
    â”‚ 3. Carrega dados:                â”‚
    â”‚                                  â”‚
    â”‚    realReportsService.          â”‚
    â”‚    getSalesReport('month')       â”‚
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ realReportsService.ts            â”‚
    â”‚                                  â”‚
    â”‚ PerÃ­odo: 'month'                 â”‚
    â”‚ â”œâ”€ Data InÃ­cio = InÃ­cio do mÃªs   â”‚
    â”‚ â””â”€ Data Fim = Fim do mÃªs         â”‚
    â”‚                                  â”‚
    â”‚ Busca do Supabase:               â”‚
    â”‚                                  â”‚
    â”‚ SELECT * FROM vendas             â”‚
    â”‚ WHERE user_id = auth.uid()       â”‚
    â”‚ AND created_at BETWEEN start/end â”‚
    â”‚                                  â”‚
    â”‚ Processa dados:                  â”‚
    â”‚ â”œâ”€ Total de vendas               â”‚
    â”‚ â”œâ”€ Total de itens                â”‚
    â”‚ â”œâ”€ Formas de pagamento           â”‚
    â”‚ â”œâ”€ Top 10 produtos               â”‚
    â”‚ â””â”€ Daily sales breakdown         â”‚
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Retorna: SalesReport              â”‚
    â”‚ {                                 â”‚
    â”‚   totalSales: 45,                â”‚
    â”‚   totalAmount: 12500.00,         â”‚
    â”‚   paymentMethods: [              â”‚
    â”‚     { method: 'pix', count: 20,  â”‚
    â”‚       amount: 5000 },            â”‚
    â”‚     { method: 'credit', count: 15â”‚
    â”‚       amount: 7500 }             â”‚
    â”‚   ],                             â”‚
    â”‚   topProducts: [                 â”‚
    â”‚     { productName: 'Produto A',  â”‚
    â”‚       quantity: 150,             â”‚
    â”‚       revenue: 3000 }            â”‚
    â”‚   ],                             â”‚
    â”‚   dailySales: [                  â”‚
    â”‚     { date: '2025-02-01',        â”‚
    â”‚       amount: 500, count: 5 }    â”‚
    â”‚   ]                              â”‚
    â”‚ }                                â”‚
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ RelatoriosPageAdvanced renderiza       â”‚
    â”‚                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ KPI CARDS (Topo)                 â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â”‚ Total Vendas: 45    â†‘ 10%        â”‚  â”‚
    â”‚  â”‚ Ticket MÃ©dio: R$ 277,78  â†“ 2%   â”‚  â”‚
    â”‚  â”‚ Receita: R$ 12.500  â†‘ 5%        â”‚  â”‚
    â”‚  â”‚ Clientes: 38        â†‘ 8%        â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ GrÃ¡fico 1: Vendas por Dia        â”‚  â”‚
    â”‚  â”‚ (LineChart)                      â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â”‚   /\\                           â”‚  â”‚
    â”‚  â”‚  /  \\                    /\\    â”‚  â”‚
    â”‚  â”‚ /    \\                  /  \\  â”‚  â”‚
    â”‚  â”‚/      \\  /\\            /    \\ â”‚  â”‚
    â”‚  â”‚        \\/  \\          /      \\â”‚  â”‚
    â”‚  â”‚            \\        /        â”‚  â”‚
    â”‚  â”‚  Fev:1 2 3 4 5 6 7 ... 28 29â”‚  â”‚
    â”‚  â”‚                              â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ GrÃ¡fico 2: Formas de Pagamento   â”‚  â”‚
    â”‚  â”‚ (PieChart)                       â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â”‚        PIX: 44%                  â”‚  â”‚
    â”‚  â”‚      [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]                  â”‚  â”‚
    â”‚  â”‚ CrÃ©dito: 33%                     â”‚  â”‚
    â”‚  â”‚      [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]                    â”‚  â”‚
    â”‚  â”‚ DÃ©bito: 23%                      â”‚  â”‚
    â”‚  â”‚      [â–ˆâ–ˆâ–ˆâ–ˆ]                      â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ GrÃ¡fico 3: Top 10 Produtos       â”‚  â”‚
    â”‚  â”‚ (BarChart)                       â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â”‚ Produto A â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1500        â”‚  â”‚
    â”‚  â”‚ Produto B â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    1100        â”‚  â”‚
    â”‚  â”‚ Produto C â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   800         â”‚  â”‚
    â”‚  â”‚ Produto D â–‘â–‘â–‘â–‘â–‘      520         â”‚  â”‚
    â”‚  â”‚                                  â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                        â”‚
    â”‚  [Exportar PDF] [Exportar Excel]       â”‚
    â”‚                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. FLUXO: PERMISSÃ•ES & CONTROLE DE ACESSO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PROCESSO DE LOGIN               â”‚
â”‚                                      â”‚
â”‚ Email: admin@empresa.com.br          â”‚
â”‚ Senha: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                      â”‚
â”‚                                      â”‚
â”‚ [Login]                              â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Supabase Auth                â”‚
    â”‚ (PKCE Flow)                  â”‚
    â”‚                              â”‚
    â”‚ 1. Valida credenciais        â”‚
    â”‚ 2. Gera JWT token            â”‚
    â”‚ 3. Salva sessÃ£o (localStorage)â”‚
    â”‚ 4. Retorna user object       â”‚
    â”‚                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AuthContext.login()          â”‚
    â”‚                              â”‚
    â”‚ - Salva user em state        â”‚
    â”‚ - Redireciona para /dashboardâ”‚
    â”‚ - Dispara PermissionsProviderâ”‚
    â”‚                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PermissionsProvider                â”‚
    â”‚ (usePermissions hook)              â”‚
    â”‚                                    â”‚
    â”‚ loadPermissions() inicia:          â”‚
    â”‚                                    â”‚
    â”‚ 1. Busca usuario logado            â”‚
    â”‚ 2. Verifica contexto de funcionÃ¡rioâ”‚
    â”‚    (localStorage)                  â”‚
    â”‚                                    â”‚
    â”‚ â”€ Se proprietÃ¡rio:                 â”‚
    â”‚   â””â”€ Carrega todas permissÃµes      â”‚
    â”‚                                    â”‚
    â”‚ â”€ Se funcionÃ¡rio:                  â”‚
    â”‚   â””â”€ Carrega apenas suas funcÃµes   â”‚
    â”‚      via table: funcionarios       â”‚
    â”‚          JOIN funcoes              â”‚
    â”‚          JOIN permissoes           â”‚
    â”‚                                    â”‚
    â”‚ 3. Salva em context React          â”‚
    â”‚ 4. Notifica componentes            â”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Dashboard (DashboardPageNew)      â”‚
    â”‚                                  â”‚
    â”‚ Usa hooks:                       â”‚
    â”‚ â”œâ”€ useUserHierarchy()           â”‚
    â”‚ â”‚  â””â”€ getVisibleModules()       â”‚
    â”‚ â”‚     â””â”€ Retorna menus baseado  â”‚
    â”‚ â”‚        em permissÃµes          â”‚
    â”‚ â”‚                               â”‚
    â”‚ â”œâ”€ useModulosHabilitados()      â”‚
    â”‚ â”‚  â””â”€ Retorna se mÃ³dulos       â”‚
    â”‚ â”‚     estÃ£o habilitados para    â”‚
    â”‚ â”‚     a empresa                 â”‚
    â”‚ â”‚                               â”‚
    â”‚ â””â”€ usePermissions()             â”‚
    â”‚    â””â”€ Verifica 'vendas:criar'   â”‚
    â”‚       antes de renderizar       â”‚
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Menu renderizado dinamicamente      â”‚
    â”‚                                    â”‚
    â”‚ âœ… Se user Ã© proprietÃ¡rio:         â”‚
    â”‚    [Vendas] [Caixa] [RelatÃ³rios]   â”‚
    â”‚    [Clientes] [Admin] [Configs]    â”‚
    â”‚                                    â”‚
    â”‚ âš ï¸ Se user Ã© vendedor:             â”‚
    â”‚    [Vendas] [Caixa] (Sem Admin)    â”‚
    â”‚                                    â”‚
    â”‚ ğŸ”’ Se user nÃ£o tem permissÃ£o:      â”‚
    â”‚    Menu item oculto ou desabilitadoâ”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User clica em menu item            â”‚
    â”‚ "RelatÃ³rios" â†’ /relatorios         â”‚
    â”‚                                    â”‚
    â”‚ ProtectedRoute valida:            â”‚
    â”‚ â”œâ”€ User logado? âœ… SIM             â”‚
    â”‚ â””â”€ Redirecionar? NÃƒO              â”‚
    â”‚                                    â”‚
    â”‚ SubscriptionGuard valida:         â”‚
    â”‚ â”œâ”€ Assinatura ativa? âœ… SIM        â”‚
    â”‚ â””â”€ Redirecionar? NÃƒO              â”‚
    â”‚                                    â”‚
    â”‚ RLS Supabase valida:              â”‚
    â”‚ â””â”€ SELECT * FROM vendas WHERE     â”‚
    â”‚    user_id = auth.uid() âœ…        â”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PÃ¡gina de RelatÃ³rios carregada     â”‚
    â”‚ (acesso concedido âœ…)              â”‚
    â”‚                                    â”‚
    â”‚ Dados renderizados:               â”‚
    â”‚ - Apenas dados do user            â”‚
    â”‚ - RLS garante isolamento          â”‚
    â”‚ - Multi-tenant seguro             â”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. MATRIZ DE COBERTURA DE FUNCIONALIDADES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FUNCIONALIDADE          â”‚ STATUS â”‚ COMPLETUDE â”‚ NOTAS      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AutenticaÃ§Ã£o            â”‚ âœ…     â”‚ 100%       â”‚ Supabase   â”‚
â”‚ Dashboard              â”‚ âœ…     â”‚ 100%       â”‚ 27 menus   â”‚
â”‚ Vendas                 â”‚ âœ…     â”‚ 100%       â”‚ Carrinho   â”‚
â”‚ Caixa (Abrir/Fechar)   â”‚ âœ…     â”‚ 100%       â”‚ Completo   â”‚
â”‚ RelatÃ³rios             â”‚ âœ…     â”‚ 100%       â”‚ 9 tipos    â”‚
â”‚ GrÃ¡ficos               â”‚ âœ…     â”‚ 100%       â”‚ Recharts   â”‚
â”‚ ExportaÃ§Ãµes            â”‚ âœ…     â”‚ 100%       â”‚ PDF/Excel  â”‚
â”‚ PermissÃµes             â”‚ âœ…     â”‚ 100%       â”‚ RLS + rolesâ”‚
â”‚ Clientes               â”‚ âš ï¸     â”‚ 95%        â”‚ Falta novo â”‚
â”‚ Produtos               â”‚ âš ï¸     â”‚ 85%        â”‚ Falta novo â”‚
â”‚ Ordens de ServiÃ§o      â”‚ âœ…     â”‚ 100%       â”‚ CRUD ok    â”‚
â”‚ Fornecedores           â”‚ âœ…     â”‚ 100%       â”‚ CRUD ok    â”‚
â”‚ Contas a Pagar         â”‚ âœ…     â”‚ 100%       â”‚ Completo   â”‚
â”‚ ConfiguraÃ§Ãµes          â”‚ âœ…     â”‚ 100%       â”‚ Ok         â”‚
â”‚ PWA                    â”‚ âœ…     â”‚ 90%        â”‚ Offline    â”‚
â”‚ Backup/ImportaÃ§Ã£o      â”‚ âœ…     â”‚ 100%       â”‚ 3 tipos    â”‚
â”‚ Loja Online            â”‚ âœ…     â”‚ 95%        â”‚ Funcional  â”‚
â”‚ Admin                  â”‚ âœ…     â”‚ 95%        â”‚ Super-ok   â”‚
â”‚                                                            â”‚
â”‚                  COBERTURA TOTAL: 92%                     â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ESTRUTURA DE BANCO DE DADOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPABASE DATABASE SCHEMA                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Auth Layer (Supabase):
â”œâ”€ auth.users
â”‚  â”œâ”€ id (UUID)
â”‚  â”œâ”€ email
â”‚  â”œâ”€ encrypted_password
â”‚  â””â”€ email_confirmed_at

Business Tables:
â”œâ”€ empresas
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK â†’ auth.users]
â”‚  â”œâ”€ nome
â”‚  â”œâ”€ cnpj
â”‚  â”œâ”€ modulos_habilitados (JSON)
â”‚  â”‚  â”œâ”€ vendas: boolean
â”‚  â”‚  â”œâ”€ ordens_servico: boolean
â”‚  â”‚  â”œâ”€ estoque: boolean
â”‚  â”‚  â””â”€ relatorios: boolean
â”‚  â””â”€ criado_em

â”œâ”€ caixa
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK, RLS]
â”‚  â”œâ”€ empresa_id (UUID) [FK]
â”‚  â”œâ”€ valor_inicial (numeric)
â”‚  â”œâ”€ valor_final (numeric)
â”‚  â”œâ”€ status ('aberto' | 'fechado')
â”‚  â”œâ”€ diferenca (numeric)
â”‚  â”œâ”€ data_abertura (timestamp)
â”‚  â”œâ”€ data_fechamento (timestamp)
â”‚  â”œâ”€ observacoes (text)
â”‚  â”œâ”€ criado_em (timestamp)
â”‚  â””â”€ atualizado_em (timestamp)

â”œâ”€ movimentacoes_caixa
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ caixa_id (UUID) [FK]
â”‚  â”œâ”€ user_id (UUID) [FK, RLS]
â”‚  â”œâ”€ tipo ('entrada' | 'saida')
â”‚  â”œâ”€ descricao (text)
â”‚  â”œâ”€ valor (numeric)
â”‚  â”œâ”€ venda_id (UUID) [FK, opcional]
â”‚  â”œâ”€ data (timestamp)
â”‚  â”œâ”€ criado_em (timestamp)
â”‚  â””â”€ atualizado_em (timestamp)

â”œâ”€ vendas
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK, RLS]
â”‚  â”œâ”€ empresa_id (UUID) [FK]
â”‚  â”œâ”€ cliente_id (UUID) [FK, opcional]
â”‚  â”œâ”€ caixa_id (UUID) [FK]
â”‚  â”œâ”€ total_amount (numeric)
â”‚  â”œâ”€ desconto_amount (numeric)
â”‚  â”œâ”€ payment_method ('cash'|'pix'|'card')
â”‚  â”œâ”€ status ('pending'|'completed'|'cancelled')
â”‚  â”œâ”€ observacoes (text)
â”‚  â”œâ”€ created_at (timestamp)
â”‚  â””â”€ updated_at (timestamp)

â”œâ”€ vendas_itens
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ venda_id (UUID) [FK]
â”‚  â”œâ”€ produto_id (UUID) [FK]
â”‚  â”œâ”€ quantidade (numeric)
â”‚  â”œâ”€ unit_price (numeric)
â”‚  â”œâ”€ total_price (numeric)
â”‚  â”œâ”€ created_at (timestamp)
â”‚  â””â”€ updated_at (timestamp)

â”œâ”€ produtos
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK, RLS]
â”‚  â”œâ”€ empresa_id (UUID) [FK]
â”‚  â”œâ”€ nome (text)
â”‚  â”œâ”€ descricao (text)
â”‚  â”œâ”€ codigo_barras (text, UNIQUE)
â”‚  â”œâ”€ sku (text)
â”‚  â”œâ”€ preco (numeric)
â”‚  â”œâ”€ custo (numeric)
â”‚  â”œâ”€ estoque (numeric)
â”‚  â”œâ”€ estoque_minimo (numeric)
â”‚  â”œâ”€ ativo (boolean)
â”‚  â”œâ”€ unidade (text)
â”‚  â”œâ”€ criado_em (timestamp)
â”‚  â””â”€ atualizado_em (timestamp)

â”œâ”€ clientes
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK, RLS]
â”‚  â”œâ”€ empresa_id (UUID) [FK]
â”‚  â”œâ”€ nome (text)
â”‚  â”œâ”€ cpf_cnpj (text, UNIQUE)
â”‚  â”œâ”€ email (text)
â”‚  â”œâ”€ telefone (text)
â”‚  â”œâ”€ endereco (jsonb)
â”‚  â”œâ”€ ativo (boolean)
â”‚  â”œâ”€ criado_em (timestamp)
â”‚  â””â”€ atualizado_em (timestamp)

â”œâ”€ funcionarios
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ user_id (UUID) [FK]
â”‚  â”œâ”€ empresa_id (UUID) [FK]
â”‚  â”œâ”€ nome (text)
â”‚  â”œâ”€ email (text, UNIQUE)
â”‚  â”œâ”€ funcao_id (UUID) [FK]
â”‚  â”œâ”€ ativo (boolean)
â”‚  â”œâ”€ criado_em (timestamp)
â”‚  â””â”€ atualizado_em (timestamp)

â”œâ”€ funcoes
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ nome (text)
â”‚  â”œâ”€ descricao (text)
â”‚  â”œâ”€ escopo_lojas (jsonb)
â”‚  â”œâ”€ ativo (boolean)
â”‚  â””â”€ criado_em (timestamp)

â”œâ”€ permissoes
â”‚  â”œâ”€ id (UUID) [PK]
â”‚  â”œâ”€ recurso (text) ['vendas', 'caixa', 'relatorios']
â”‚  â”œâ”€ acao (text) ['visualizar', 'criar', 'editar', 'deletar']
â”‚  â”œâ”€ descricao (text)
â”‚  â””â”€ criado_em (timestamp)

â””â”€ funcao_permissoes
   â”œâ”€ id (UUID) [PK]
   â”œâ”€ funcao_id (UUID) [FK]
   â”œâ”€ permissao_id (UUID) [FK]
   â””â”€ criado_em (timestamp)

RLS Policies Applied to All User Data:
â”œâ”€ caixa â†’ WHERE user_id = auth.uid()
â”œâ”€ movimentacoes_caixa â†’ WHERE user_id = auth.uid()
â”œâ”€ vendas â†’ WHERE user_id = auth.uid()
â”œâ”€ produtos â†’ WHERE user_id = auth.uid()
â”œâ”€ clientes â†’ WHERE user_id = auth.uid()
â””â”€ ... (todos isolados por user_id)
```

---

## 8. ROADMAP DE CORREÃ‡Ã•ES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROADMAP DE MELHORIAS RECOMENDADAS              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SEMANA 1 (CorreÃ§Ãµes CrÃ­ticas):
â”Œâ”€ [ ] Proteger rota /produtos                 (5 min)
â”œâ”€ [ ] Remover pÃ¡ginas de teste (/teste, /test) (15 min)
â”œâ”€ [ ] Criar rota /clientes/novo               (30 min)
â”œâ”€ [ ] Criar rota /produtos/novo               (30 min)
â”œâ”€ [ ] Criar rota /caixa/fechar                (30 min)
â””â”€ [ ] Testar todos os fluxos                  (2 h)

SEMANA 2 (Melhorias de UX):
â”Œâ”€ [ ] Adicionar links no menu do Dashboard    (30 min)
â”œâ”€ [ ] Criar rota /vendas/cupons               (1 h)
â”œâ”€ [ ] Criar rota /admin/usuarios              (1 h)
â”œâ”€ [ ] Implementar confirmaÃ§Ã£o para delete     (30 min)
â””â”€ [ ] Melhorar responsividade mobile          (1 h)

SEMANA 3 (Performance):
â”Œâ”€ [ ] Implementar Supabase Realtime           (1-2 h)
â”œâ”€ [ ] Virtual scrolling em listas             (1 h)
â”œâ”€ [ ] Lazy load de grÃ¡ficos                   (1 h)
â”œâ”€ [ ] Cache de relatÃ³rios                     (1 h)
â””â”€ [ ] Testes automÃ¡ticos (Jest + RTL)         (2-3 h)

MESES 2-3 (Novos Recursos):
â”Œâ”€ [ ] Dashboard DRE (P&L)                     (3-4 h)
â”œâ”€ [ ] AnÃ¡lise ABC de produtos                 (2-3 h)
â”œâ”€ [ ] IntegraÃ§Ã£o WhatsApp automÃ¡tico          (2-3 h)
â”œâ”€ [ ] IntegraÃ§Ã£o Email automÃ¡tico             (1-2 h)
â”œâ”€ [ ] Mobile app (React Native)               (20-30 h)
â””â”€ [ ] IntegraÃ§Ã£o contabilidade (Blip/Omie)    (5-10 h)

TOTAL ESFORÃ‡O:
â”œâ”€ Semana 1: 4-5 horas
â”œâ”€ Semana 2: 4-5 horas
â”œâ”€ Semana 3: 6-8 horas
â””â”€ Meses 2-3: 40-50 horas
```

---

**Documento Gerado:** 4 de fevereiro de 2026  
**Ãšltima AtualizaÃ§Ã£o:** 4 de fevereiro de 2026
